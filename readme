Основные моменты:

0. Как происходит ответ на запрос

    на входе
    - httpQuery
        - method
        - host
        - uri
        - status

        |
        |   роутинг
       \|/
        '

    получаем
    - theme
    - block
        - name
        - params
        - template
    - positions
        [
            - name
        ]

        |
        |   вызываем первый блок
       \|/
        '
    response

1. роутинг

    селектор это:
        - host - регулярное выражение
        - uri - регулярное выражение
        - method - методы через запятую
        - status - число

    Селектор сравнивается со значениями в httpQuery
        - method - должен содержаться в селекторе
        - status - должен быть равен селектору

    Регулярные выражения:
        сопоставляется httpQuery.host+httpQuery.uri
        c регурярным выражением selector.host+selector.uri
        получается выборка параметров из строки httpQuery...
        нужен способ восстановить по этим параметрам url


'$lang.sitename.com', '/catalog/$cat_id/$item_id'
{
    $lang       [a-z]{2}
    $cat_id     [0-9]+
    $item_id    [0-9]+
}

'', '/news/$day-$month-$year'
{
    $host       [^/]+
    $day        [0-9]{2}
    $month      [0-9]{2}
    $year       [0-9]{4}
}


selector: {
    method: 'GET, POST',
    status: 200,
    host: '$lang.sitename.com',
    uri: '/catalog/$cat_id/$item_id',
    params: {
        lang: '[a-z]{2}',
        cat_id: '[0-9]+',
        item_id: '[0-9]+',
    }

    regexp: '([a-z]{2})\.sitename\.com/catalog/([0-9]+)/($item_id)';
}